<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<!--<script src="./keythereum.min.js" type="text/javascript"></script>-->
<script src="./keythereum.js" type="text/javascript"></script>
<script src="./dist/ethereumjs-tx/ethereumjs-tx-1.3.3.js" type="text/javascript"></script>

<!--<script src="./dist/ethereumjs-tx/ethereumjs-tx-1.3.3.js" type="text/javascript"></script>-->


<script>



    //
    var keythereum = window.keythereum;

    // synchronous
//    var dk = keythereum.create(null);
//    console.log(dk);
//
//    // 生成地址
//    var options = {
//        kdf : "scrypt",
//        cipher : "aes-128-ctr"
//    };
//    var password = "123456";
//    var keyObject = keythereum.dump(password, dk.privateKey, dk.salt, dk.iv, options);
//    //
//    console.log(keyObject);
//
//    // 导出地址文件
//    // 导出自己写，浏览器里不支持node.js相关文件
    keythereum.exportToFile(keyObject);
//    window.console.log("导出完毕");


//     new ethereumjs.VM();

//    //2. 导入地址
//    var datadir = "/Users/tianlei/Desktop";
//
//    // Synchronous
//    var keyObject = keythereum.importFromFile("dc5a40c19daa00be31db4f2beb29e65e27c19fe0", datadir);

    //3.导出私钥    Uint8Array
//    console.log("私钥");
//    var privateKey = keythereum.recover(password, keyObject);
//    console.log(privateKey);
    //////////////////////////////////////////////////////////

//    console.log(privateKey.toSource("hex"));

//    function ab2str(buf) {
//        return );
//    }


//    var textBinary = privateKey;
//    var blob = new Blob([textBinary]);
//    //读取文件中的内容为字符串
//    var fr = new FileReader;
//    fr.readAsText(blob);
//    fr.onload = function(){
//        alert('文本文件中的内容是：' + fr.result);//这里是abc
//    }

    //////////////////////////////////////////////////////////
    console.log("开始构造交易");
//    console.log(privateKey.toString("utf-8"));
    var rawTx = {
        nonce: '0x02',
        gasPrice: '0x04e3b29200',
        gasLimit: '0x5208',
        to: '0x010a181AE56C0A5e6215196aA5C726A3B2564a00',
        value: '0x0de0b6b3a7640000',
        data:'',
        //公网chainId为1
        chainId: 1
//        chainId : 123456
    }
//    ethereumjs.Buffer.Buffer.from("hello","hex");
    var tx = new ethereumjs.Tx(rawTx);
    var b =   ethereumjs.Buffer.Buffer.from('664dec5e2bfcba39fbba80acc355fd4ebf559a5a4bf5a7d7f8f99cefadb84a9d','hex');
    console.log("构造完成");


//    var tx = new Tx(rawTx);
//    var  tx = new Transaction(rawTx);
    tx.sign(b);
    var serializedTx = tx.serialize();

    console.log(serializedTx);
    var str = '0x' + serializedTx.toString("hex");
     console.log(str);
    // 0xf889808609184e72a00082271094000000000000000000000000000000000000000080a47f74657374320000000000000000000000000000000000000000000000000000006000571ca08a8bbf888cfa37bbf0bb965423625641fc956967b81d12e23709cead01446075a01ce999b56a8a88504be365442ea61239198e23d1fce7d00fcfc5cd3b44b7215f

//    web3.eth.sendSignedTransaction('0x' + serializedTx.toString('hex'))




</script>

</body>
</html>